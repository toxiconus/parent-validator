<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ekstraktor Danych - A.Gene</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="parent-validator.css?v=20251222-5">
    <link rel="stylesheet" href="edit-modal.css">
</head>
<body>
    <nav class="breadcrumb">
        <a href="../../../index.html"><span class="material-icons">home</span> A.Gene</a>
        <span>/</span>
        <a href="../../../index.html">Modu≈Çy</a>
        <span>/</span>
        <span>Ekstraktor Danych</span>
    </nav>

    <div class="container">
        <!-- Panel kontrolny -->
        <div class="control-panel">
            <!-- Textarea do wklejania danych -->
            <div class="paste-section" id="pasteSection">
                <label for="pasteTextarea" class="section-label">
                    <span class="material-icons">content_paste</span> Wklej lub przeciƒÖgnij dane tutaj:
                </label>
                <div class="parse-info" id="parseInfo" style="display: none;">
                    Wykryto <strong id="detectedRows">0</strong> wierszy w formacie <strong id="detectedFormat">TAB</strong>
                </div>
                <textarea id="pasteTextarea" class="paste-textarea" 
                    placeholder="Wklej dane (Ctrl+V) lub przeciƒÖgnij plik tutaj...&#10;&#10;Obs≈Çugiwane formaty:&#10;- TAB-separated (Excel/Calc)&#10;- CSV (przecinkami)&#10;- Pliki .txt, .tsv, .csv&#10;&#10;Skr√≥ty: Ctrl+V (wklej) | Ctrl+O (otw√≥rz plik)"></textarea>
                
                <!-- PodglƒÖd sparsowanych danych wej≈õciowych -->
                <div class="input-preview" id="inputPreview" style="display: none;">
                    <div class="preview-header">
                        <span class="material-icons">visibility</span>
                        <span>PodglƒÖd danych (<span id="previewRowCount">0</span> wierszy, <span id="previewColCount">0</span> kolumn)</span>
                    </div>
                    <div class="preview-table-wrapper">
                        <table class="preview-table" id="previewTable">
                            <thead id="previewTableHead"></thead>
                            <tbody id="previewTableBody"></tbody>
                        </table>
                    </div>
                </div>
                
                <div class="paste-buttons">
                    <button id="parseButton" class="btn btn-info">
                        <span class="material-icons">check_circle</span> Wczytaj dane z pola
                    </button>
                    <button class="btn btn-secondary" onclick="loadParserResults()">
                        <span class="material-icons">science</span> Za≈Çaduj z parsera
                    </button>
                    <button class="btn btn-outline" onclick="clearPasteArea()">
                        <span class="material-icons">clear</span> Wyczy≈õƒá
                    </button>
                    <button class="btn btn-small" onclick="showFormatHelp()">
                        <span class="material-icons">help</span> Pomoc
                    </button>
                </div>
            </div>
        </div>

        <!-- Tabela edycji -->
        <div class="table-wrapper" id="tableWrapper">
            <!-- Okienko z oryginalnƒÖ liniƒÖ -->
            <div class="original-line-display" id="originalLineDisplay" style="display: none;">
                <div class="line-content" id="originalLineContent"></div>
            </div>
            
            <div class="table-header-actions">
                <button class="btn btn-small" onclick="togglePanels()" title="Ukryj/poka≈º panele">
                    <span class="material-icons" id="togglePanelsIcon">unfold_less</span>
                </button>
            </div>

            <table class="data-table" id="dataTable">
                <thead>
                    <tr>
                        <th class="col-id sticky-col sortable" data-sort="id">ID</th>
                        <th class="col-year sortable" data-sort="year">ROK</th>
                        <th class="col-number sortable" data-sort="number">Nr.</th>
                        <th class="col-surname sortable" data-sort="surname">Nazwisko</th>
                        <th class="col-name sortable" data-sort="name">Imiƒô</th>
                        <th class="col-place sortable" data-sort="place">Miejscowo≈õƒá</th>
                        <th class="col-father sortable" data-sort="fatherName">ImiƒôO</th>
                        <th class="col-father-surname sortable" data-sort="fatherSurname">NazwiskoO</th>
                        <th class="col-father-age sortable" data-sort="fatherAge">wiekO</th>
                        <th class="col-mother sortable" data-sort="motherName">IM</th>
                        <th class="col-mother-surname sortable" data-sort="motherSurname">NM</th>
                        <th class="col-mother-age sortable" data-sort="motherAge">wM</th>
                        <th class="col-notes sortable" data-sort="notes">uwagi</th>
                        <th class="col-original">UWAGI ORG</th>
                        <th class="col-actions">Akcje</th>
                    </tr>
                </thead>
                <tbody id="tableBody">
                    <!-- Wpisywane dynamicznie -->
                </tbody>
            </table>
            
            <!-- Kontrolki paginacji -->
            <div class="pagination-container" id="paginationControls"></div>
            
            <div class="table-footer">
                <div id="tableSummary">
                    Kliknij na kom√≥rkƒô w kolumnach ojca/matki aby edytowaƒá
                </div>
            </div>
        </div>

        <!-- Kontrolki i statystyki (po≈ÇƒÖczone na d√≥≈Ç) -->
        <div class="bottom-panel" id="bottomPanel" style="display: none;">
            <div class="bottom-row">
                <div class="bottom-left">
                    <button class="btn-toggle-controls" onclick="toggleTableControls()" title="Poka≈º/ukryj filtry i opcje">
                        <span class="material-icons">expand_more</span> Opcje
                    </button>
                    <button class="btn btn-small" onclick="showFormatHelp()">
                        <span class="material-icons">help</span> Pomoc
                    </button>
                </div>
                
                <div class="stats-inline">
                    <div class="stat-item">
                        <span class="material-icons">assessment</span>
                        <span class="stat-label">Wczytanych:</span>
                        <span class="stat-value" id="recordCount">0</span>
                    </div>
                    <span class="stat-separator">|</span>
                    <div class="stat-item">
                        <span class="material-icons">check_circle</span>
                        <span class="stat-label">Zatwierdzone:</span>
                        <span class="stat-value" id="confirmedCount">0</span>
                    </div>
                    <span class="stat-separator">|</span>
                    <div class="stat-item">
                        <span class="material-icons">warning</span>
                        <span class="stat-label">Weryfikacja:</span>
                        <span class="stat-value" id="warningCount">0</span>
                    </div>
                    <span class="stat-separator">|</span>
                    <div class="stat-item">
                        <span class="material-icons">cloud_upload</span>
                        <span class="stat-label">Postƒôp:</span>
                        <span class="stat-value" id="progressPercent">0%</span>
                    </div>
                </div>
            </div>
            
            <div class="table-controls">
                
                <div class="search-group" id="searchGroup" style="display: none;">
                    <div class="search-input-wrapper">
                        <span class="material-icons">search</span>
                        <input type="text" id="searchInput" placeholder="Szukaj w nazwiskach, imionach, miejscach..." class="search-input">
                        <button class="btn btn-small" id="clearSearchBtn" title="Wyczy≈õƒá wyszukiwanie">
                            <span class="material-icons">clear</span>
                        </button>
                    </div>
                </div>
                
                <div class="filter-group" id="filterGroup" style="display: none;">
                    <label>
                        <input type="checkbox" id="filterRed" checked> 
                        <span>Do weryfikacji</span>
                    </label>
                    <label>
                        <input type="checkbox" id="filterGreen" checked> 
                        <span>Zatwierdzone</span>
                    </label>
                    <label>
                        <input type="checkbox" id="filterGray" checked> 
                        <span>BrakujƒÖce</span>
                    </label>
                    <div class="filter-counter">
                        Wy≈õwietlono: <span id="filteredCount">0</span> / <span id="totalCount">0</span>
                    </div>
                </div>
                <div class="action-group" id="actionGroup" style="display: none;">
                    <div class="export-controls">
                        <select id="exportFormat" class="btn btn-small">
                            <option value="tsv">TSV</option>
                            <option value="csv">CSV</option>
                            <option value="json">JSON</option>
                            <option value="xlsx">Excel</option>
                        </select>
                        <button class="btn btn-small btn-outline" id="columnSelectBtn" onclick="toggleColumnSelector()">
                            <span class="material-icons">view_column</span> Kolumny
                        </button>
                        <button class="btn btn-small btn-primary" id="exportBtn">
                            <span class="material-icons">download</span> Eksportuj
                        </button>
                    </div>
                    <div id="columnSelector" class="column-selector" style="display: none;">
                        <div class="column-selector-header">
                            <span>Wybierz kolumny do eksportu:</span>
                            <button class="btn btn-tiny" onclick="selectAllColumns()">Wszystkie</button>
                            <button class="btn btn-tiny" onclick="selectBasicColumns()">Podstawowe</button>
                        </div>
                        <div class="column-checkboxes">
                            <label><input type="checkbox" value="id" checked> ID</label>
                            <label><input type="checkbox" value="year" checked> Rok</label>
                            <label><input type="checkbox" value="number" checked> Nr</label>
                            <label><input type="checkbox" value="surname" checked> Nazwisko</label>
                            <label><input type="checkbox" value="name" checked> Imiƒô</label>
                            <label><input type="checkbox" value="place" checked> Miejscowo≈õƒá</label>
                            <label><input type="checkbox" value="fatherName"> Imiƒô ojca</label>
                            <label><input type="checkbox" value="fatherSurname"> Nazwisko ojca</label>
                            <label><input type="checkbox" value="fatherAge"> Wiek ojca</label>
                            <label><input type="checkbox" value="motherName"> Imiƒô matki</label>
                            <label><input type="checkbox" value="motherSurname"> Nazwisko matki</label>
                            <label><input type="checkbox" value="motherAge"> Wiek matki</label>
                            <label><input type="checkbox" value="recordType"> Typ rekordu</label>
                            <label><input type="checkbox" value="notes"> Uwagi</label>
                            <label><input type="checkbox" value="isModified"> Zmodyfikowany</label>
                        </div>
                    </div>
                    <button class="btn btn-small btn-secondary" id="saveBtn">
                        <span class="material-icons">save</span> Zapisz w przeglƒÖdarce
                    </button>
                    <button class="btn btn-small btn-outline" onclick="clearAllData()">
                        <span class="material-icons">delete</span> Wyczy≈õƒá wszystkie
                    </button>
                </div>
            </div>
        </div>

        <!-- Modal edycji zostanie za≈Çadowany dynamicznie z edit-modal.html -->
        <div id="modalContainer"></div>
        
        <!-- Loader -->
        <div class="loader" id="loader">
            <div class="loader-spinner"></div>
            <p>≈Åadowanie danych...</p>
        </div>
        
        <!-- Help modal -->
        <div class="modal-overlay" id="helpModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Instrukcja obs≈Çugi</h2>
                    <button class="close-btn" onclick="document.getElementById('helpModal').style.display='none'">√ó</button>
                </div>
                <div class="modal-body">
                    <div>
                        <strong>4 sposoby za≈Çadowania:</strong>
                        <ol>
                            <li>üìÅ <strong>Plik:</strong> TSV/CSV/JSON/XLSX</li>
                            <li>üìã <strong>Wklej:</strong> Ctrl+V z Excela</li>
                            <li>‚öôÔ∏è <strong>Parser:</strong> 5947 rekord√≥w z akt chrzt√≥w (backend Python)</li>
                            <li>üìù <strong>Przyk≈Çad:</strong> dane testowe</li>
                        </ol>
                    </div>
                    <div style="margin-top: 1rem; padding: 1rem; background: #1a1a1a; border-left: 3px solid #4fc3f7; border-radius: 3px;">
                        <strong>Backend Python:</strong> Aplikacja u≈ºywa serwera Flask na porcie 5000<br/>
                        Parsowanie i walidacja odbywajƒÖ siƒô po stronie serwera.<br/>
                        <strong>Znaczenie kolor√≥w:</strong><br/>
                        üü¢ Zielone = zatwierdzone | üî¥ Czerwone = do sprawdzenia | ‚ö™ Szare = brakujƒÖce
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- G≈Ç√≥wny skrypt -->
    <script src="parent-validator.js?v=20251222-10"></script>
</body>
</html>
